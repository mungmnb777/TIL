# 로드밸런서

# 1. 개요

현대에는 스마트폰과 LTE등의 빠른 네트워크의 보급으로 누구나 쉽게 인터넷에 접근할 수 있게 되었다. 그 결과 인기있는 서비스는 많은 클라이언트의 트래픽을 감당해야 할 것이고 그러기 위해서는 서버를 업그레이드 시켜야 할 것이다.

이 때 서버를 업그레이드 하는 방식은 두 가지 방법이 있다.

-   Scale-up
    -   하드웨어 자체를 업그레이드 하는 방식
-   Scale-Out
    -   서버를 여러 개 두는 방식

Scale-up 방식의 경우 하드웨어의 성능이 높아지면 높아질 수록 가격이 급등하기 떄문에 비용면에서도 만만치 않지만, 결국 하나의 서버로 처리하게 되면 역시나 트래픽을 감당하기 힘들 수도 있다.

이를 해결하고자 Scale-out으로 서버를 늘리고 여러 서버에서 트래픽을 감당하는 ‘**분산 처리**’라는 기술이 나왔고 이를 일관성있게, 그리고 효율적으로 처리하기 위한 기술이 바로 로드밸런싱이다.

# 2. 로드밸런서

로드밸런서는 서버에 가해지는 트래픽 혹은 부하를 분산해주는 장치 또는 기술을 말한다. 클라이언트와 서버 사이에 위치해서 클라이언트의 요청을 여러 서버에게 나누어 주는 역할을 한다. 상위 계층으로 갈수록 더욱 섬세한 부하 분산이 가능하지만 가격이 비싸진다는 단점이 있다.

## 2.1 로드밸런서의 종류

로드밸런서는 L2, L3, L4, L7이 있다. 각각의 숫자의 의미는 OSI 7 계층의 각 계층 레벨이다. 주로 사용하는 로드밸런서는 L4 로드밸런서와 L7 로드밸런서이다.

L4 로드밸런서는 Transport 계층을 사용하고 TCP/UDP 포트 정보를 기준으로 요청을 분배하는 것이 가능하다.

L7 로드밸런서는 Application 계층을 사용하기 때문에 리소스를 기준으로 요청을 분배하는 것이 가능하다.

아래의 표를 보면 더욱 이해가 잘 될 것 같다.

<p align="center">
	<img src="../images/load balancer.png"><br>
	<em>그림 1) 로드 밸런서의 두 가지 타입</em>
</p>

## 2.2 로드밸런싱 알고리즘

### 2.2.1 Round Robin

부하를 서버에 순차적으로 분산하는 방식이다. 현재 서버에 연결된 상태가 얼마나 되는지는 신경쓰지 않고 서버에서 정해놓은 순서대로 클라이언트와 서버를 연결한다.

### 2.2.2 Least Connection

서버 중 연결 갯수가 가장 적은 서버에 요청을 전달하는 방식이다. 일반적인 서버 로드밸런싱의 경우에는 대부분 이 옵션을 사용한다.

### 2.2.3 Source IP Hash

이 방법이 되게 어렵고 신선한 방법인 것 같았다. 클라이언트로부터 들어오는 IP 정보를 바탕으로 해싱한 결과에 따라 해당하는 서버로 요청을 전달하는 방식이다.

이 방식의 경우에는 똑같은 사용자의 요청은 항상 똑같은 서버가 도맡아 처리하기 때문에 세션을 유지해야하는 사이트에서 주로 사용한다.

## 2.3 로드밸런싱의 주요 기술

-   NAT(Network Address Translation) : 사설 IP 주소를 공인 IP 주소로 바꾸는 데 사용하는 통신망의 주소 변조기 ([참고](https://aws-hyoh.tistory.com/145))
-   DSR(Dynamic Source Routing Protocol) : 로드 밸런서 사용 시 서버에서 클라이언트로 되돌아가는 경우 목적지 주소를 스위치의 IP 주소가 아닌 클라이언트의 IP 주소로 전달해서 네트워크 스위치를 거치지 않고 바로 클라이언트를 찾아가는 개념
-   Tunneling : 인터넷 상에서 눈에 보이지 않는 통로를 만들어 통신할 수 있게 하는 개념으로, 데이터를 캡슐화해서 연결된 상호 간에만 캡슐화된 패킷을 굽려해 캡슐화를 해제할 수 있다.
