# 1. Proxy

프록시는 양쪽 엔드포인트간의 통신에서 중계기로서 대리로 통신을 수행하는 것을 말한다. 그리고 그 중계 기능을 하는 서버를 프록시 서버라고 부른다.

# 2. Proxy의 활용

<p align="center">
    <img src="../images/forward proxy.png"><br>
    <em>그림 1) Forward Proxy</em>
</p>

일반적으로 단순하게 프록시라 이야기하면 `forward proxy`라고 가정한다. 이 경우에는 클라이언트가 서버로 요청할 때 직접 요청하는 것이 아닌 프록시 서버를 거쳐서 웹에 접근하는 것을 말한다.

## 2.1. 우회

어떤 클라이언트의 IP 주소가 `3.3.3.3`이라고 하고 네이버의 Origin 서버의 IP 주소를 `5.5.5.5`라고 생각하자. 이 클라이언트에서 네이버의 Origin 서버와 통신을 하고자 한다. 이 때 클라이언트 브라우저에 프록시 설정이 되어 있다고 생각하자. 이 때 프록시의 주소는 `7.7.7.7`이라고 생각하자.

이 때, 클라이언트에서 `7.7.7.7`이라는 주소를 가진 프록시 서버로 TCP/IP 통신을 먼저 하게 되고, 프록시 서버에서 네이버 Origin 서버로 TCP/IP 통신이 이루어진다.

이 때, 네이버 입장에서는 어디에서 접속했다고 인식할까? 네이버에서 받은 패킷을 확인했을 떄 프록시 서버의 IP 주소가 확인이 되므로, 만약에 프록시 서버가 중국에 있는 서버일 경우 중국에서 접속했다고 인식하게 되는 것이다.

이를 `우회`라고 말한다.

그런데 이 때 우리가 인식해야 할 점은 이 프록시 서버가 클라이언트와 서버 사이에서 발생하는 모든 통신을 감청할 수 있다. 이를 주의해야 한다.

## 2.2. 분석

최근 우리는 HTTP에 SSL을 합쳐 보안적인 측면을 강화시킨 HTTPS라는 프로토콜을 이용한다. 그러면 양쪽 엔드포인트간의 통신이 일어날 때 암호화되어 안전한 통신을 기대할 수 있다. 그런데 가끔 통신 상태를 모니터링해야 할 상황이 발생할 경우 패킷이 암호화되어 있어 분석하기가 어렵다.

이를 해결하기 위한 아이디어로 브라우저의 프록시 설정을 자기 자신의 IP 주소로 하는 것이다. 그러면 브라우저에서 소켓을 열어서 Transport Layer로 가는 것이 아니라 소켓에서 바로 프록시 서버로 이동한다. 그 후 프록시에서 소켓을 열어 Transport Layer로 이동하게 된다. 이 때 중요한 점은 프록시 서버에서 Transport Layer로 나갈 때 암호화를 한다는 점이다. 즉, 프록시 서버에서는 평문으로 이루어진 데이터를 가지고 있기 때문에 손쉽게 데이터를 분석할 수 있다.

## 2.3. 감시와 보호

클라이언트에서 `4.4.4.4`라는 IP 주소로 접속한다고 가정하자. 그런데 이 사이트는 악성 코드를 내재하고 있는 사이트이다. 만약 클라이언트에서 직접 사이트에 접근하게 된다면 악성 코드에 감염될 것이다. 하지만 프록시 서버를 이용해서 사이트에 접근하면 악성코드가 클라이언트에 도달하기 전에 프록시 서버에서 먼저 걸러지게 된다. 따라서 보호의 기능을 수행할 수 있다.

또한 반대로 감시 역할도 가능하다. 클라이언트에서 네이버 서버와 통신을 한다고 가정했을 때, 클라이언트가 프록시 서버를 거쳐갈 경우 프록시 서버에서 이를 확인할 수 있다.

## 2.4. Reverse Proxy

<p align="center">
    <img src="../images/reverse proxy.png"><br>
    <em>그림 2) Reverse Proxy</em>
</p>

`reverse proxy`는 포워드 프록시와 반대이다. 클라이언트가 서버를 호출할 때 리버스 프록시를 호출하고, 프록시 서버가 Origin Server에 요청을 전달하는 방식이다.

이 경우의 장점은 무엇일까? 기본적으로 인터넷은 public IP를 이용해야 한다. 하지만 프록시 서버와 Origin 서버에서는 보통 private IP를 이용하기 때문에 외부에서는 Origin 서버에 접근할 수 없다.

또한 `reverse proxy`도 감시 및 보호가 가능하다. 그렇기 때문에 해커의 공격을 미리 알고 차단할 수 있다.

# 참고

[널널한 개발자 TV](https://www.youtube.com/watch?v=dThqHi8-MiQ&list=PLXvgR_grOs1BFH-TuqFsfHqbh-gpMbFoy&index=20)
