# 1. 성능과 최적화

## 1.1. 자바 성능: 잘못된 방법

인터넷에서 찾은 정보는 무턱대고 믿지 마라. 특히 과거의 글은 현재 방식과 완전히 다를 수 있으니 주의해야 한다.

## 1.2. 자바 성능 개요

> 자바는 블루 컬러(생산직에 종사하는 육체 노동자) 언어이다. 박사 학위 논문 주제가 아니라 일을 하려고 만든 언어이다.
> 

제임스 고슬링의 말이다. 자바는 처음 출시되었을 때부터 실용성을 중시했고 개발 환경이 충분히 빠르다면 개발자 생산성이 높아지는 대가로 어느 정도의 성능 희생은 감수할 만하다는 입장을 가지고 있었다.

이러한 특징은 `서브 시스템`이 대표적이다. 특히 자바에서는 `Garbage Collector`라는 메모리 관리 서브 시스템이 있다. GC는 메모리를 자동 관리해주기 때문에 프로그래머는 수동으로 메모리를 의식할 필요가 없어졌다.

자바에는 GC말고도 다양한 서브 시스템이 존재한다. 이들은 그 존재 자체로 JVM 애플리케이션 런타임 동작에 복잡도를 유발한다. 여러 시스템을 인지하며 생각하며 측정하게 되는 JVM 애플리케이션의 성능 측정은 어렵다.

## 1.3. 성능은 실험과학이다

JVM 성능 튜닝은 기술, 방법론, 정량적 측정값, 툴을 망라한 개념이다. 그 목표는 시스템 소유자/유저가 추구하는 측정 결과를 얻는 것이다.

성능은 다음과 같은 활동을 하면서 측정하고 개선할 수 있다.

- 원하는 결과를 정의한다.
- 기존 시스템을 측정한다.
- 요건을 충족시키려면 무슨 일을 해야 할지 정한다.
- 개선 활동을 추진한다.
- 다시 테스트한다.
- 목표가 달성됐는지 판단한다.

## 1.4. 성능 분류

성능 지표는 성능 분석의 어휘집이자 튜닝 프로젝트의 목표를 정량적인 단위로 표현한 기준이다. 다음은 가장 일반적인 기본 성능 지표이다.

- 처리율
- 지연
- 용량
- 사용률
- 효율
- 확장성
- 저하

### 1.4.1 처리율(Throughput)

처리율은 서브 시스템이 수행 가능한 작업 비율을 나타낸 지표이다. 보통 일정 시간동안 완료한 작업 단위 수로 표시한다.

처리율의 지표를 소개할 때 수치를 얻은 기준 플랫폼에 대해서도 기술해야 한다.

→ 예) 하드웨어 스펙, OS, 소프트웨어 스택 등

그리고 트랜잭션은 테스트할 때마다 동일해야 한다. 또 실행 간 워크로드 역시 일정하게 유지해야 한다.

### 1.4.2. 지연(Latency)

지연은 하나의 트랜잭션을 처리하고 그 결과가 나올 때까지 소요된 시간을 의미한다.

### 1.4.3. 용량(Capacity)

용량은 시스템이 보유한 작업 병렬성의 총량, 즉 시스템이 동시 처리 가능한 트랜잭션의 개수를 말한다.

용량은 처리율과 밀접한 연관이 있다. 시스템에 동시 부하가 증가할수록 처리율도 당연히 영향을 받는다.

### 1.4.4. 사용률(Utilization)

사용률은 워크로드에 따라서 리소스별로 들쑥날쑥할 수 있다. 예를 들면 그래픽 처리와 암호화와 같은 계산을 많이 하는 워크로드를 주면 CPU 사용률은 100%에 육박하지만 메모리 사용률은 얼마 나오지 않는다.

### 1.4.5. 효율(Efficiency)

전체 시스템의 효율은 처리율을 리소스 사용률로 나눈 값으로 측정한다. 즉 같은 처리율을 더 많은 리소스를 쏟아부어야 달성할 수 있다면 효율이 낮은 것이다.

### 1.4.6. 확장성(Scalability)

리소스를 추가하면서 발생하는 처리율이 변화하는 정도가 시스템/애플리케이션의 확장성을 가늠하는 척도이다. 시스템 확장성은 정확히 리소스를 투입한 만큼 처리율이 변경되는 형태를 지향한다.

### 1.4.7. 저하(Degradation)

시스템이 더 많은 부하를 받으면 자연스럽게 지연이 발생한다. 시스템이 풀 가동된 상태에는 처리율이 더는 늘어나지 않는데, 이런 현상을 부하 증가에 따른 저하라고 한다.